# Admin Dashboard 会员管理功能

## 新增功能概述

已在Admin Dashboard中添加了完整的用户会员管理功能，管理员可以：

- 📊 查看会员统计数据
- 👥 管理所有用户的会员状态
- ✅ 授权用户会员资格
- ❌ 取消用户会员
- ⏰ 延长会员有效期
- 🔍 搜索和筛选用户
- 💰 查看支付历史

## 功能详细说明

### 1. Admin Dashboard 更新

**路径**: `/admin`

**更新内容**:
- 将原来的"Membership Management"拆分为两个独立的功能模块
- **Membership Plans** (`/admin/membership`) - 管理会员计划
- **User Memberships** (`/admin/user-memberships`) - 管理用户会员
- 统一了所有按钮的样式，使用蓝色主题

### 2. 用户会员管理页面

**路径**: `/admin/user-memberships`

**主要功能**:

#### 统计数据显示
- 总用户数
- 活跃会员数
- 非会员用户数
- 可用会员计划数

#### 搜索和筛选
- **搜索**: 按邮箱或姓名搜索用户
- **筛选选项**:
  - All Users (所有用户)
  - Members (会员用户)
  - Non-Members (非会员用户)

#### 用户管理操作
- **查看用户信息**: 邮箱、姓名、角色、注册时间
- **会员状态标识**: 绿色标签显示活跃会员，灰色标签显示非会员
- **当前会员信息**: 显示用户所有活跃的会员计划和到期时间

#### 会员操作功能
- **授权新会员**: 为用户授予任意可用的会员计划
- **延长会员期限**: 为现有会员延长30天有效期
- **取消会员**: 取消用户的活跃会员资格

### 3. API 路由

#### 新增的管理员API
- **`/api/admin/cancel-membership`** (POST)
  - 取消用户会员资格
  - 将状态设置为 CANCELLED

- **`/api/admin/extend-membership`** (POST)
  - 延长用户会员有效期
  - 可延长1-365天

- **`/api/admin/payment-history`** (GET)
  - 查看支付历史记录
  - 支持分页和用户筛选
  - 提供收入统计

#### 现有API增强
- **`/api/admin/users`** - 增强返回用户会员信息
- **`/api/admin/grant-membership`** - 授权会员资格

### 4. 用户界面特点

#### 设计风格
- 响应式设计，支持移动端
- 清晰的视觉层次
- 直观的操作按钮
- 实时状态反馈

#### 交互体验
- 操作按钮显示加载状态
- 成功/错误消息提示
- 自动刷新数据
- 防重复提交保护

## 使用指南

### 管理员操作流程

1. **访问用户会员管理**
   - 登录管理员账号
   - 进入 Admin Dashboard
   - 点击 "Manage User Memberships"

2. **查找目标用户**
   - 使用搜索框输入用户邮箱或姓名
   - 或使用筛选按钮筛选会员/非会员用户

3. **授权新会员**
   - 在用户卡片下方找到 "Grant New Membership" 区域
   - 点击相应的会员计划按钮
   - 系统会自动创建会员记录

4. **管理现有会员**
   - 查看 "Current Memberships" 区域
   - 点击 "Extend +30d" 延长会员期限
   - 点击 "Cancel" 取消会员资格

5. **查看操作结果**
   - 操作完成后会显示成功/失败消息
   - 页面数据会自动刷新
   - 用户状态标签会实时更新

### 权限控制

- 所有管理功能只对具有 `ADMIN` 角色的用户开放
- API 路由都有身份验证和角色验证
- 非管理员访问会显示拒绝页面

### 数据安全

- 所有操作都有完整的日志记录
- 敏感操作需要管理员令牌验证
- 数据库操作使用事务保证一致性

## 技术实现

### 前端技术
- React + TypeScript
- Tailwind CSS 样式
- 实时状态管理
- 响应式设计

### 后端技术
- Next.js API Routes
- Prisma ORM
- JWT 身份验证
- PostgreSQL 数据库

### 数据库模型
- `UserMembership` - 用户会员关系
- `Membership` - 会员计划
- `Payment` - 支付记录
- `User` - 用户信息

## 系统优势

1. **管理效率高**: 直观的界面，批量操作支持
2. **功能完整**: 涵盖会员生命周期的所有操作
3. **安全可靠**: 完善的权限控制和数据验证
4. **扩展性好**: 模块化设计，易于添加新功能
5. **用户体验佳**: 实时反馈，操作简单直观

## 未来扩展计划

1. **批量操作**: 支持批量授权/取消会员
2. **高级筛选**: 按会员类型、到期时间等筛选
3. **数据导出**: 支持导出用户会员数据
4. **邮件通知**: 会员状态变更自动发送邮件
5. **统计报表**: 更详细的会员数据分析和图表 